<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contributors | Admin</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/admin.css">
    <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v7.1.0/css/all.css">
    <style>
        body { background: transparent; padding: 0; margin: 0; overflow-x: hidden; }
        .admin-layout { min-height: auto; background: transparent; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.05);
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(0,0,0,0.2);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0,0,0,0.3);
        }
        body.dark-theme ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
        }
        body.dark-theme ::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
        }

        /* Add Button Style */
        .btn-add {
            background: var(--brand-primary);
            color: white;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: var(--radius-md);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            transition: background 0.2s;
        }
        .btn-add:hover {
            background: var(--brand-primary-dark, #2563eb);
        }
    </style>
</head>
<body>
    <script>
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-theme');
        }
    </script>
    <div class="page-header">
        <div class="page-title">
            <h1>Contributors</h1>
            <p>Manage system contributors and their permissions.</p>
        </div>
        <button class="btn-add" onclick="openAddModal()">
            <i class="fas fa-plus"></i> Add Contributor
        </button>
    </div>

    <div class="card">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Full Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Last Login</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data will be loaded here -->
            </tbody>
        </table>
    </div>

    <!-- Add Modal -->
    <div class="modal-overlay" id="addModal">
        <div class="modal-container">
            <div class="modal-header">
                <h2>Add New Contributor</h2>
                <button class="close-modal" onclick="closeModal('addModal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form id="addForm" onsubmit="event.preventDefault(); saveNewContributor();">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="addName" required>
                    </div>
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" id="addEmail" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="addPassword" required>
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" id="addPhone" placeholder="98XXXXXXXX">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('addModal')">Cancel</button>
                <button class="btn-submit" style="width: auto; padding: 0.6rem 1.5rem;" onclick="saveNewContributor()">Add Contributor</button>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal-overlay" id="editModal">
        <div class="modal-container">
            <div class="modal-header">
                <h2>Edit Contributor</h2>
                <button class="close-modal" onclick="closeModal('editModal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form id="editForm">
                    <input type="hidden" id="editId">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="editName" required>
                    </div>
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" id="editEmail" required>
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" id="editPhone" placeholder="98XXXXXXXX">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('editModal')">Cancel</button>
                <button class="btn-submit" style="width: auto; padding: 0.6rem 1.5rem;" onclick="saveChanges()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal-container" style="max-width: 400px;">
            <div class="modal-header">
                <h2 style="color: var(--brand-danger);">Confirm Deletion</h2>
                <button class="close-modal" onclick="closeModal('deleteModal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                    Are you sure you want to remove <strong id="deleteUserName" style="color: var(--text-primary);">User</strong>?
                </p>
                <p style="font-size: 0.85rem; color: var(--brand-danger); background: rgba(239, 68, 68, 0.1); padding: 0.75rem; border-radius: var(--radius-sm);">
                    <i class="fas fa-exclamation-triangle"></i> This action cannot be undone.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('deleteModal')">Cancel</button>
                <button class="btn-submit" style="width: auto; padding: 0.6rem 1.5rem; background: var(--brand-danger);" onclick="confirmDelete()">Delete</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', loadContributors);

        function loadContributors() {
            fetch('../API/admin/getContributors.php')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const tbody = document.querySelector('.data-table tbody');
                        tbody.innerHTML = '';
                        data.data.forEach(contributor => {
                            const initials = contributor.full_name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
                            const row = `
                                <tr>
                                    <td>
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <div class="admin-avatar" style="width: 32px; height: 32px; font-size: 0.8rem;">${initials}</div>
                                            <span style="font-weight: 500;">${contributor.full_name}</span>
                                        </div>
                                    </td>
                                    <td>${contributor.email}</td>
                                    <td>${contributor.phone || '-'}</td>
                                    <td>${contributor.last_login || 'Never'}</td>
                                    <td>
                                        <button class="action-btn edit" onclick="openEditModal(${contributor.id}, '${contributor.full_name}', '${contributor.email}', '${contributor.phone || ''}')"><i class="fas fa-pen"></i></button>
                                        <button class="action-btn delete" onclick="openDeleteModal(${contributor.id}, '${contributor.full_name}')"><i class="fas fa-trash"></i></button>
                                    </td>
                                </tr>
                            `;
                            tbody.innerHTML += row;
                        });
                    } else {
                        console.error('Failed to load contributors:', data.message);
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        // Modal Functions
        function openEditModal(id, name, email, phone) {
            document.getElementById('editId').value = id;
            document.getElementById('editName').value = name;
            document.getElementById('editEmail').value = email;
            document.getElementById('editPhone').value = phone;
            
            const modal = document.getElementById('editModal');
            modal.classList.add('active');
        }

        let userToDeleteId = null;
        function openDeleteModal(id, name) {
            userToDeleteId = id;
            document.getElementById('deleteUserName').textContent = name;
            const modal = document.getElementById('deleteModal');
            modal.classList.add('active');
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('active');
        }

        function saveChanges() {
            const id = document.getElementById('editId').value;
            const name = document.getElementById('editName').value;
            const email = document.getElementById('editEmail').value;
            const phone = document.getElementById('editPhone').value;

            fetch('../API/admin/updateContributor.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ id, full_name: name, email, phone }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Contributor updated successfully');
                    closeModal('editModal');
                    loadContributors();
                } else {
                    alert('Failed to update: ' + data.message);
                }
            })
            .catch(error => console.error('Error:', error));
        }

        function confirmDelete() {
            if (!userToDeleteId) return;

            fetch('../API/admin/deleteContributor.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ id: userToDeleteId }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Contributor deleted successfully');
                    closeModal('deleteModal');
                    loadContributors();
                } else {
                    alert('Failed to delete: ' + data.message);
                }
            })
            .catch(error => console.error('Error:', error));
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal-overlay')) {
                event.target.classList.remove('active');
            }
        }
    </script>        }
    </script>
</body>
</html>